# CLAUDE.md Draft Updates — Round 2
# Source: Gemini 2.5 Pro Deep Think
# Context: gemini-deep-think-001-intelligence-feed.md
# Date: 2026-02-12

---

## Gemini's Recommended Approach

The Unified Intelligence Feed should be architected as a **dashboard**, not a simple chronological feed. This approach positions the page as a "command center" for intelligence, providing summary analytics and deep-dive capabilities rather than a passive stream. The core of this strategy is to **unify all signal generation on the backend**, transforming the ephemeral client-side signals into persistent, queryable records in the `signals` table. This creates a single source of truth, enables historical analysis, and simplifies the front-end architecture significantly. The page will feature a primary chart for price correlation, a filterable feed of all signals, and a detail-on-demand panel to inspect the evidence behind any signal, with premium features gated at the data-depth level.

---

## A. Page Architecture

The Intelligence Feed will live at `/signals` and utilize a two-panel structure within the existing `HUDLayout` system.

### Primary View: `/signals`

- **Layout:** A main content area (`LeftPanel` or `Canvas` at 80% width) and a sidebar (`RightPanel` at 20% width) that is initially hidden.
- **Component:** `IntelligencePage`
- **Contains:**
  - **`SignalChart` (Top):** An `SGChart` instance showing the primary ticker's price history (`$ASTS` by default) with signal events plotted as markers.
  - **`FeedControls` (Middle):** A `Panel` section containing controls for filtering the feed by `category`, `severity`, and `ticker`, plus a date range selector.
  - **`SignalFeed` (Bottom):** A virtualized scrolling list of `SignalCard` components, representing the filtered signals.
- **Interaction:**
  - Clicking a `SignalCard` in the `SignalFeed` selects it, highlighting it in the feed and on the `SignalChart`.
  - Upon selection, a `SignalDetail` panel slides in from the right, displaying the full context for the selected signal. Clicking the card again or a close button on the panel will hide it.

### Detail View: `SignalDetail` Panel

A panel that appears on the right side of the screen when a signal is selected.

- **Header:** `Signal Title`, `Severity`, `Timestamp`.
- **Analysis Section:** Full `description` text generated by Haiku.
- **Metrics Section:** A dynamic view that renders key-value pairs from the `metrics` JSONB object. Uses `Label` and `Value` primitives. For example:
  - `SENTIMENT SHIFT`: `+0.18`
  - `TWEET VOLUME`: `842` (vs `310` baseline)
  - `SHORT INTEREST CHANGE`: `-14.2%`
- **Evidence Section (`source_refs`):** A list of source documents that triggered the signal. Each item links to the canonical source (e.g., the SEC filing page, the patent document). This section is a premium feature.

---

## B. Signal Taxonomy

The two signal systems will be merged. The `signal_scanner.py` worker will be expanded to compute all signals and store them in the `signals` table. A new `category` column will be added to classify signals based on investor intent, not detection method.

### Proposed Signal Categories

| Category | Description | Corresponding `signal_type`(s) |
|---|---|---|
| **Regulatory** | Filings and status changes with government bodies. | `filing_cluster`, `fcc_status_change`, `new_content` (for filings) |
| **Market** | Changes in market structure or pricing. | `short_interest_spike`, `price_event` (new) |
| **Community** | Shifts in public discussion and sentiment. | `sentiment_shift`, `cross_source` |
| **Corporate** | Official company announcements and publications. | `new_content` (for PRs), `earnings_diff` (new) |
| **Intellectual Property** | New patents and their relationships. | `patent_crossref` (new) |
| **Operations** | Satellite and network operational events. | (Future category for telemetry signals) |

The ephemeral signals from the intel page (System 2) will be integrated as new `signal_type` values and mapped to these categories.

---

## C. Price Correlation Layer

### Component: `SignalChart`

- An `SGChart` instance configured with a primary line series for price (`daily_prices` table).
- Uses the `markers` overlay feature to draw a vertical line at the `detected_at` timestamp for each signal in the current view.
- Marker color tied to signal `severity`.
- **Interaction:**
  - Hovering a marker on the chart highlights the corresponding `SignalCard` in the feed below.
  - Hovering a `SignalCard` in the feed highlights its marker on the chart.

### Computed Metric: `price_impact_24h`

- The `signal_scanner` worker will calculate the percentage price change in the 24 hours following a signal's detection.
- Stored in a new `price_impact_24h` FLOAT column in the `signals` table.
- Can be used for future "hit rate" analysis and sorting.

---

## D. Feed vs. Dashboard

The design is a **dashboard**, defined by:

1. **Summary Statistics:** A thin `Panel` at the top displaying stats derived from current filters (e.g., "Showing 25 signals: 3 critical, 12 medium", "7-day signal volume is up 15%").
2. **Rich Filtering:** `FeedControls` panel is central. Users can slice the data, not just consume it chronologically.
3. **Context-on-Demand:** `SignalDetail` panel provides deep-dive capability, turning the feed from a list of headlines into an interactive analysis tool.

---

## E. Tier Gating

| Feature | Free Tier | Full Spectrum (Premium) |
|---|---|---|
| **Page Access** | `/signals` blocked. Teaser/upsell page shown. | Full access to dashboard. |
| **`SignalFeed` Widget** | Visible in terminal sidebar. Shows severity, title, description (2-line clamp). | N/A (has full page) |
| **`SignalChart`** | Not available. | Full access, including price data and signal markers. |
| **Feed Filtering** | Not available. | Full access to category, severity, date filtering. |
| **`SignalDetail` Panel** | Not available. | Full access. |
| **Metrics (`metrics`)** | Not available. | Visible in `SignalDetail` panel. |
| **Evidence (`source_refs`)** | Not available. | Visible with links to raw documents. |

The free `SignalFeed` widget acts as a teaser for the full `/signals` dashboard.

---

## F. Data Model Changes

### Table: `signals` — New Columns

```sql
ALTER TABLE signals
  ADD COLUMN category TEXT,
  ADD COLUMN confidence_score FLOAT,
  ADD COLUMN price_impact_24h FLOAT;

CREATE INDEX idx_signals_category_severity ON signals(category, severity);
```

| Column | Type | Description |
|---|---|---|
| `category` | `TEXT` | Investor-intent category: 'regulatory', 'market', 'community', 'corporate', 'ip', 'operations' |
| `confidence_score` | `FLOAT` | For probabilistic signals (semantic cross-ref), score from 0.0 to 1.0 |
| `price_impact_24h` | `FLOAT` | Percentage price change 24h after `detected_at`. NULL until computed. |

---

## G. Worker Changes

The `signal_scanner.py` worker will be updated:

1. **Integrate Ephemeral Signals:** Port client-side logic from `useCrossRefs`, `usePriceEvents`, `useEarningsDiff` into Python functions within the worker.
2. **Generate New Signal Types:**
   - `patent_crossref`: From semantic search results. Populates `confidence_score`.
   - `price_event`: From filing velocity anomalies.
   - `earnings_diff`: From comparing new/dropped terms in transcripts.
3. **Populate New Columns:**
   - Map every `signal_type` to the new `category`.
   - After detection, query `daily_prices` to compute and store `price_impact_24h`.

---

## H. API Changes

### `GET /api/signals` — Extended

| Parameter | Type | Description |
|---|---|---|
| `category` | `string` | Comma-separated categories to include |
| `severity` | `string` | Comma-separated severities |
| `ticker` | `string` | Filter by related ticker (future use) |
| `startDate` | `ISO 8601` | Signals detected after this date |
| `endDate` | `ISO 8601` | Signals detected before this date |
| `page` | `integer` | Pagination page number |
| `limit` | `integer` | Signals per page (default 50) |

Premium response includes full `metrics` and `source_refs`. Free tier returns limited data (title + description only) or 403.

---

## I. Component Structure

| File | Purpose |
|---|---|
| `app/signals/page.tsx` | `IntelligencePage` — main page, manages filters + selected signal state |
| `components/signals/SignalCard.tsx` | Single signal row in the feed |
| `components/signals/SignalFeed.tsx` | Virtualized scrolling list of `SignalCard`s |
| `components/signals/SignalDetail.tsx` | Detail panel with metrics, description, evidence |
| `components/signals/SignalChart.tsx` | `SGChart` wrapper with price + signal markers |
| `components/signals/FeedControls.tsx` | Filter controls (category, severity, date range) |

---

## J. Implementation Phases

### Phase 1: Backend Foundation
- Modify `signals` table with new columns (`category`, `confidence_score`, `price_impact_24h`)
- Update `signal_scanner.py` to populate `category` for existing signal types
- Port one ephemeral signal (e.g., `price_event`) into the worker
- Extend `GET /api/signals` with new filter parameters

### Phase 2: Core UI Shell
- Build `IntelligencePage` layout at `/signals`
- Create `SignalFeed` and `SignalCard` components
- Build `SignalChart` with price data + signal markers

### Phase 3: Interactivity and Detail
- Implement signal selection (`SignalCard` click → `SignalDetail` panel)
- Build `SignalDetail` panel (metrics, source_refs, description)
- Implement hover-highlighting between chart and feed
- Build `FeedControls` and wire up filtering

### Phase 4: Polish and Ship
- Port remaining ephemeral signals into `signal_scanner.py`
- Implement `price_impact_24h` calculation
- Implement tier gating on API and frontend
- Loading states, empty states, error handling
